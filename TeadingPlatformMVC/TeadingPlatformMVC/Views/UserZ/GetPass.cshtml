
@{
    ViewBag.Title = "GetPass";
    Layout = null;
}

<h2>找回密码</h2>
<script src="~/Scripts/bootstrap.js"></script>
<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<table class="table">
    <tr>
        <td>输入要验证的邮箱</td>
        <td>
            <input id="Email" type="text" />
        </td>
    </tr>
    <tr>
        <td>你的真实姓名</td>
        <td>
            <input id="Name" type="text" />
        </td>
    </tr>
    <tr>
        <td>请输入验证码</td>
        <td>
            <input id="Code" type="text" /><input id="Codes" type="hidden" />
        </td>
        <td>
            <input id="Button1" onclick="GetCode()" type="button" value="获取验证码" class="btn btn-primary" />
        </td>
    </tr>
    <tr>
        <td>
            <input id="Button1" type="button" value="找回密码" onclick="GetPass()" />
        </td>
    </tr>
</table>
<script>
    function GetCode() {

        var Email_ = $("#Email").val();
        var Name_ = $("#Name").val();
        if (Email_ == "") {
            alert("QQ邮箱不能为空");
            return;
        }
        if (Name_ == "") {
            alert("用户名不能为空");
            return;
        }
        var data = {
            Name: Name_,
            Email: Email_
        };
        $.ajax({
            url: "/UserZ/GetEmailPass",
            dataType: "JSON",
            data: {
                data: JSON.stringify(data)
            },
            type: "POST",
            success: function (res) {
                $(res).each(function () {
                    var codes = this.Name;
                    $("#Codes").val(codes);
                })
            }

        })
    }
    function GetPass() {
        var code = $("#Code").val();
        var codes = $("#Codes").val();
        var Email_ = $("#Email").val();
        var Name_ = $("#Name").val();
        if (Email_ == "") {
            alert("QQ邮箱不能为空");
            return;
        }
        if (Name_ == "") {
            alert("用户名不能为空");
            return;
        }
        if (code == "") {
            alert("验证码不能为空");
            return;
        }
        if (code == codes) {
            alert("开始找回密码,请稍等三秒");
            var data = {
                Name: Name_
            }
            $.ajax({
                url: "/UserZ/SetNameGetPass",
                dataType: "json",
                data: {
                    data: JSON.stringify(data)
                },
                type: "POST",
                success: function (res)
                {
                    $(res).each(function () {
                        alert("密码是:"+this.UserPass+",记好了");
                    })
                }
            })
        }
        else {
            alert("找你妹啊");
        }

    }
</script>